
{% extends "base.html" %}

{% block title %}
    TuftedFox - Admin - Daily Page Hits
{% endblock %}

{% block head %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
    <div class="element-block" style="width: 200px;">
        <a href="/admin/dashboard"> Admin Dashboard </a>
    </div>

    {{ block_header('SQL DB QUERY', random_icon)}}
    <textarea id="queryInput" style="width: 100%; height: 30em;"></textarea>
        <button onclick="submitQuery()">Run Query</button>
        <button onclick="clearOutput()">Clear Output</button>
        <div id="queryResult"></div>
    {{ block_footer() }}

    {{block_header('Query Results',random_icon)}}
    <div id="query_results"></div>
    {{block_footer()}}

<script>
    function submitQuery() {
        clearOutput();

        const query = document.getElementById('queryInput').value;
        fetch('/api/execute-query', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ query: query })
        })
        .then(response => response.json())
        .then(data => {

            const formattedData = JSON.stringify(data, null, 2); // Indent with 2 spaces for readability
            document.getElementById('query_results').innerHTML = createHtmlTableFromData(data);
            
        }).catch(error => {
            document.getElementById('query_results').textContent = error;
        });
    }

    function clearOutput(){
        document.getElementById('query_results').innerHTML = '';
    }

    function createHtmlTableFromData(data) {
        // Start with the opening of the table and the header row
        let tableHtml = "<table><thead><tr>";
    
        // Add a header cell for each column
        data.columns.forEach(column => {
            tableHtml += `<th>${column}</th>`;
        });
    
        // Close the header row and start the body
        tableHtml += "</tr></thead><tbody>";
    
        // Add a row for each entry in the rows array
        data.rows.forEach(row => {
            tableHtml += "<tr>";
            data.columns.forEach(column => {
                tableHtml += `<td>${row[column]}</td>`; // Access the value of each column for this row
            });
            tableHtml += "</tr>";
        });
    
        // Close the table
        tableHtml += "</tbody></table>";
    
        return tableHtml;
    }
</script>

{% endblock %}
